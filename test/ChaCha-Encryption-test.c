#include <stdio.h>
#include "chacha20.h"
/*
*/
int main(void) {
    
    uint32_t key[8] = {0x03020100,  0x07060504,  0x0b0a0908,  0x0f0e0d0c,
                       0x13121110,  0x17161514,  0x1b1a1918,  0x1f1e1d1c};
    uint32_t counter = 0x00000001;
    uint32_t nonce[3] = {0x00000000,  0x4a000000,  0x00000000};

    uint8_t plaintext[] = {
        0x4c, 0x61, 0x64, 0x69, 0x65, 0x73, 0x20, 0x61,
        0x6e, 0x64, 0x20, 0x47, 0x65, 0x6e, 0x74, 0x6c,
        0x65, 0x6d, 0x65, 0x6e, 0x20, 0x6f, 0x66, 0x20,
        0x74, 0x68, 0x65, 0x20, 0x63, 0x6c, 0x61, 0x73,
        0x73, 0x20, 0x6f, 0x66, 0x20, 0x27, 0x39, 0x39,
        0x3a, 0x20, 0x49, 0x66, 0x20, 0x49, 0x20, 0x63,
        0x6f, 0x75, 0x6c, 0x64, 0x20, 0x6f, 0x66, 0x66,
        0x65, 0x72, 0x20, 0x79, 0x6f, 0x75, 0x20, 0x6f,
        0x6e, 0x6c, 0x79, 0x20, 0x6f, 0x6e, 0x65, 0x20,
        0x74, 0x69, 0x70, 0x20, 0x66, 0x6f, 0x72, 0x20,
        0x74, 0x68, 0x65, 0x20, 0x66, 0x75, 0x74, 0x75,
        0x72, 0x65, 0x2c, 0x20, 0x73, 0x75, 0x6e, 0x73,
        0x63, 0x72, 0x65, 0x65, 0x6e, 0x20, 0x77, 0x6f,
        0x75, 0x6c, 0x64, 0x20, 0x62, 0x65, 0x20, 0x69,
        0x74, 0x2e 
    };
    uint8_t ciphertext[114];
    /*
    uint8_t ciphertext[] = {
        0x6e, 0x2e, 0x35, 0x9a, 0x25, 0x68, 0xf9, 0x80,
        0x41, 0xba, 0x07, 0x28, 0xdd, 0x0d, 0x69, 0x81,
        0xe9, 0x7e, 0x7a, 0xec, 0x1d, 0x43, 0x60, 0xc2,
        0x0a, 0x27, 0xaf, 0xcc, 0xfd, 0x9f, 0xae, 0x0b,
        0xf9, 0x1b, 0x65, 0xc5, 0x52, 0x47, 0x33, 0xab,
        0x8f, 0x59, 0x3d, 0xab, 0xcd, 0x62, 0xb3, 0x57,
        0x16, 0x39, 0xd6, 0x24, 0xe6, 0x51, 0x52, 0xab,
        0x8f, 0x53, 0x0c, 0x35, 0x9f, 0x08, 0x61, 0xd8,
        0x07, 0xca, 0x0d, 0xbf, 0x50, 0x0d, 0x6a, 0x61,
        0x56, 0xa3, 0x8e, 0x08, 0x8a, 0x22, 0xb6, 0x5e,
        0x52, 0xbc, 0x51, 0x4d, 0x16, 0xcc, 0xf8, 0x06,
        0x81, 0x8c, 0xe9, 0x1a, 0xb7, 0x79, 0x37, 0x36,
        0x5a, 0xf9, 0x0b, 0xbf, 0x74, 0xa3, 0x5b, 0xe6,
        0xb4, 0x0b, 0x8e, 0xed, 0xf2, 0x78, 0x5e, 0x42,
        0x87, 0x4d
    };
    */
//    uint32_t *thirty_two_byte_array = (uint32_t*)plaintext;

//     // Print the 32-byte array
//     for (int i = 0; i < 29; ++i) {
//         printf("%08x ", thirty_two_byte_array[i]);
//     }
    printf("====== Encryption Test ======\n\n");
    printf("plaintext is:\n");
    for (int i = 0; i < 114; i++) {
        if (i != 0 && i % 16 == 0)
            printf("\n");
        printf("0x%02x ", plaintext[i]);
    }
    printf("\n\n");
    chacha20_encrypt(key, counter, nonce, (uint32_t *)plaintext, (uint32_t *)ciphertext, sizeof(plaintext));
    printf("User's ciphertext:\n");
    for (int i = 0; i < 114; i++) {
        if (i != 0 && i % 16 == 0)
            printf("\n");
        printf("0x%02x ", ciphertext[i]);
    }
    printf("\n\nAnswer is:\n");

    printf("0x6e 0x2e 0x35 0x9a 0x25 0x68 0xf9 0x80 0x41 0xba 0x07 0x28 0xdd 0x0d 0x69 0x81\n");
    printf("0xe9 0x7e 0x7a 0xec 0x1d 0x43 0x60 0xc2 0x0a 0x27 0xaf 0xcc 0xfd 0x9f 0xae 0x0b\n");
    printf("0xf9 0x1b 0x65 0xc5 0x52 0x47 0x33 0xab 0x8f 0x59 0x3d 0xab 0xcd 0x62 0xb3 0x57\n");
    printf("0x16 0x39 0xd6 0x24 0xe6 0x51 0x52 0xab 0x8f 0x53 0x0c 0x35 0x9f 0x08 0x61 0xd8\n");
    printf("0x07 0xca 0x0d 0xbf 0x50 0x0d 0x6a 0x61 0x56 0xa3 0x8e 0x08 0x8a 0x22 0xb6 0x5e\n");
    printf("0x52 0xbc 0x51 0x4d 0x16 0xcc 0xf8 0x06 0x81 0x8c 0xe9 0x1a 0xb7 0x79 0x37 0x36\n");
    printf("0x5a 0xf9 0x0b 0xbf 0x74 0xa3 0x5b 0xe6 0xb4 0x0b 0x8e 0xed 0xf2 0x78 0x5e 0x42\n0x87 0x4d\n");

    printf("\n\n====== Decryption Test ======\n\n");
    chacha20_encrypt(key, counter, nonce, (uint32_t *)ciphertext, (uint32_t *)ciphertext, sizeof(ciphertext));
    printf("Hexadecimal type:\n");
    for (int i = 0; i < 114; i++) {
        if (i != 0 && i % 16 == 0)
            printf("\n");
        printf("0x%02x ", ciphertext[i]);
    }
    printf("\n\nCharicters type:\n");
    for (int i = 0; i < 114; i++) {
        printf("%c", ciphertext[i]);
    }
    printf("\n");
}